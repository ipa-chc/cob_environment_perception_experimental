<html>
<head>
	<!-- Source: http://wiki.openstreetmap.org/wiki/Openlayers_Track_example -->
	<title>Simple OSM GPX Track</title>
	<!-- bring in the OpenLayers javascript library
		 (here we bring it from the remote site, but you could
		 easily serve up this javascript yourself) -->
	<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
	<!-- bring in the OpenStreetMap OpenLayers layers.
		 Using this hosted file will make sure we are kept up
		 to date with any necessary changes -->
	<script src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
 
	<script type="text/javascript">
 
		var map; //complex object of type OpenLayers.Map
 
		function init() {
			map = new OpenLayers.Map ("map", {
				controls:[
					new OpenLayers.Control.Navigation(),
					new OpenLayers.Control.PanZoomBar(),
					new OpenLayers.Control.LayerSwitcher(),
					new OpenLayers.Control.Attribution()],
				maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
				maxResolution: 156543.0399,
				numZoomLevels: 19,
				units: 'm',
				projection: new OpenLayers.Projection("EPSG:900913"),
				displayProjection: new OpenLayers.Projection("EPSG:4326")
			} );
 
			// Define the map layer
			// Here we use a predefined layer that will be kept up to date with URL changes
			layerMapnik = new OpenLayers.Layer.OSM.Mapnik("Mapnik");
			map.addLayer(layerMapnik);
			layerCycleMap = new OpenLayers.Layer.OSM.CycleMap("CycleMap");
			map.addLayer(layerCycleMap);
			layerMarkers = new OpenLayers.Layer.Markers("Markers");
			map.addLayer(layerMarkers);
 
			// Add the Layer with the GPX Track
			var lgpx = new OpenLayers.Layer.Vector("Lakeside cycle ride", {
				strategies: [new OpenLayers.Strategy.Fixed()],
				protocol: new OpenLayers.Protocol.HTTP({
					url: "file:///tmp/path.gpx",
					format: new OpenLayers.Format.GPX()
				}),
				style: {strokeColor: "green", strokeWidth: 5, strokeOpacity: 0.5},
				projection: new OpenLayers.Projection("EPSG:4326")
			});
			map.addLayer(lgpx);
 
 
 
 
			var markers = {};
		 
			$.ajax( {url: "file:///tmp/wifis.csv", dataType: 'text',
				complete: function( data ) {
					var lines = data.responseText.split("\n");
					for(var i=0; i<lines.length; i++) {
						var d = lines[i].split(";");
 
						var lonLat = new OpenLayers.LonLat( d[1], d[2] )
						  .transform(
							new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
							map.getProjectionObject() // to Spherical Mercator Projection
						  );
					  
					  if(!markers[d[0]]) {
						  markers[d[0]] = new OpenLayers.Layer.Markers( "Markers" );
						  //markers[d[0]].setVisibility(false);
						  //map.addLayer(markers[d[0]]);
						  
						  $("#control").append('<input type="checkbox" id="chk_'+d[0]+'" />'+d[0]+' ');
						  $('#chk_'+d[0]).data("ssid", d[0]).click( function(){
							   if( $(this).is(':checked') ) map.addLayer(markers[$(this).data("ssid")]);//markers[$(this).data("ssid")].setVisibility(true);
							   else map.removeLayer(markers[$(this).data("ssid")]);//markers[$(this).data("ssid")].setVisibility(false);
							});

					  }
			  
						markers[d[0]].addMarker(new OpenLayers.Marker(lonLat));
					}
			
				//for(var m in markers)
				//	markers[m].setVisibility(false);
			} });
			
			
 
			// Start position for the map (hardcoded here for simplicity,
			// but maybe you want to get this from the URL params)
			var lat=48.693;
			var lon=9.16768;
			var zoom=15;
			var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
			map.setCenter(lonLat, zoom);
		}
	</script>
 
</head>
<!-- body.onload is called once the page is loaded (call the 'init' function) -->
<body onload="init();">
	<!-- define a DIV into which the map will appear. Make it take up the whole window -->
	<div style="width:90%; height:90%" id="map"></div>
	<div id="control" />
</body>
</html>
